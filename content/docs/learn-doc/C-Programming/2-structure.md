---
title: 结构
authors:
  - EndlessPeak
toc: true
featuredImage: 
date: 2022-02-10
hidden: false
draft: false
weight: 3
---


## 程序实例

下面是first.c的程序代码

```c
#include <stdio.h>
int main(int argc, char *argv[]){
    int num;
    num=1;
    printf("I am a simple");
    printf("computer.\n");
    printf("My favorite number is %d because it is first.\n",num);
    return 0;
}
```

运行结果是：

```
I am a simple computer.
My favorite number is 1 because it is first.
```

若存在程序的输出在屏幕上一闪而过的情况，这是因为某些窗口环境配合某些集成开发环境会在单独的窗口运行程序，运行结束后会自动关闭窗口。

可以通过添加额外的代码让窗口等待用户按下一个键后再关闭，比如下面的两种方法：

```c
getchar();
system("pause");
```

## 概要解释

```
典型的C程序
	├── #include 
    |		└──预处理器指令
	├── int main(int argc, char *argv[])
	|		├── main()总是第1个被调用的函数
	|		├── int argc表示接收参数的个数
	|		├── char *argv[]表示接收参数的字符串
	|		└── 语句 ── 组成main函数的语句
	├── function a(参数列表)
	|		└── 语句 ── 组成function a函数的语句
	├── function a(参数列表)
	|		|	└────── 语句 ── 组成function a函数的语句
	| 函数是C程序的构造块	  |
	├── ……				    ├── 标号语句
	……					    ├── 表达式语句 
						    ├── 选择语句 
						    ├── 迭代语句
						    ├── 跳转语句
						    └── 复合语句
```

## 详细解释

1. 语句单位※

   C语言中共有六种语句：**标号/标签**语句、**表达式**语句、**选择**语句、**迭代**语句、**跳转**语句和**复合**语句。

   语句一般由**关键字**、**标识符**、**运算符**和**数据**组成，由分号结尾。

   标号/标签语句

   ```c
   identifier:statement
   case constant-expression:statement
   default:statement
   ```

   表达式语句

   1. 空语句属于表达式语句；
   2. 赋值语句属于表达式语句；
   3. **函数调用**语句属于**表达式**语句

   ```c
   expression(opt)
   ```

   选择语句

   ```c
   switch(expression) statement
   if(expression) statement
   if(expression) statement else statement
   ```

   迭代/循环语句

   ```
   while(expression) statement
   do statement while(expression)
   for(expression(opt);expression(opt);expression(opt)) statement
   for(declaration expression(opt); expression(opt)) statement
   ```

   跳转语句

   ```c
   goto identifier
   continue
   break
   return expression(opt)
   ```

   复合语句

   简称为语句块，它使用大括号把许多语句和声明组合到一起，形成单条语句。

   ```c
   {block-item-list(opt)}
   ```

2. `#include`指令和头文件

   `#include<stdio.h>`作用相当于把`stdio.h`文件中的所有内容都输入到该行所在的位置，即拷贝-粘贴的操作。

   **预处理器指令**：通常，C编译器在编译前会对源代码做一些准备工作，这个过程叫预处理。令编译器进行预处理的是预处理器指令。

   例如需要保证头文件仅只编译一次时，可添加如下预处理器指令：

   ```c
   //直接使用pragma once指令保证仅编译一次
   #pragma once
   
   //使用冗余包含哨卫，即双重#ifndef语句实现仅编译一次
   #ifndef identifier 
   #define identifier
   #endif
   
   #ifndef identifier
   #include "header"
   #endif
   ```

   **头文件**：在C程序源文件顶部的信息集合被称为头文件，比如本程序的`#include<stdio.h>`即是将`stdio.h`头文件放到该程序源文件的顶部。其中，`stdio.h`文件是标准输入/输出头文件。它包含了供编译器使用的输入和输出函数。

   **引入头文件的目的**：头文件一般包含了编译器创建最终可执行程序时所需要用到的信息，比如定义的常量或者指明函数名以及如何使用它们。

   > 头文件与对应的C语言源文件
   >
   > 一般地，一个头文件会对应一个C语言源文件，对于标准库的头文件来说，它的C语言源文件在标准库的库文件中，这些源文件均具有已经预编译好的目标代码文件；而对于用户自己定义的头文件来说，它的C语言源文件由用户自己编写，并且不具有已经预编译好的目标代码文件，需要用户手动编译。
   >
   > 简而言之，头文件帮助编译器把你的程序正确地组合在一起。每个C语言源文件都可以引入很多头文件，而每个头文件必须有且只有一个源文件与它对应。
   >

3. 函数与`main()`函数

   **函数**：函数是具有某些特定功能，能执行特定操作的代码块；函数中包含一些声明和语句，以说明操作的过程。变量则用于存储计算过程中使用的值。

   **主函数**：标准形式是`int main(int argc, char *argv[])`。

   C程序一般情况下均从`main()`函数开始执行，`int`指它的返回类型是整数。**编译器不必接收其他返回的数据类型**，即定义`void main()`或`main()` 存在风险。

   `int argc`表示接收参数的个数，`char *argv[]`表示接收参数的字符串。

4. 变量声明与赋值

   **声明**：`int num;`表示声明变量，一是函数中定义名为`num`的变量；二是`int`表明`num`是一个整数类型，程序运行时将为`num`变量分配4字节的存储空间。

   > 为什么需要声明变量：
   >
   > 1. 变量声明可以集中放置，提高程序的可读性，编写时需要作更详尽的思考。
   > 2. 变量声明有助于发现隐藏在程序中的错误，如前后两次使用同一变量时输入错误。
   > 3. 变量声明才能使C程序通过编译
   >
   
   **关键字**：高级语言定义的特殊单词，在高级语言范围内不能做任何其他用途。定义基本数据类型的单词都属于关键字，比如`int`表示C语言的基本数据类型——整数。ISO定义的C关键字如下。

   | 关键字         | 标准  | 描述                                                         |
   | -------------- | ----- | ------------------------------------------------------------ |
   | auto           | K&R C | 声明函数局部变量，动态分配存储空间                           |
   | extern         | K&R C | 外部变量声明，表示该变量是其他文件已经定义的外部变量         |
   | static         | K&R C | 声明具有静态存储期的数据                                     |
   | register       | K&R C | 声明尽可能使用寄存器存储类型的变量，以提高执行效率           |
   | inline         | C99   | 声明内联类型                                                 |
   | while          | K&R C | 程序循环                                                     |
   | for            | K&R C | 程序循环                                                     |
   | do             | K&R C | 程序循环                                                     |
   | break          | K&R C | 跳出当前循环语句                                             |
   | continue       | K&R C | 跳出当前循环语句，开始下一次循环                             |
   | char           | K&R C | 声明单字符型变量                                             |
   | short          | K&R C | 声明短整型数据                                               |
   | void           | K&R C | 声明无类型的变量                                             |
   | int            | K&R C | 声明整型变量                                                 |
   | long           | K&R C | 声明长整型变量                                               |
   | float          | K&R C | 声明单精度浮点数                                             |
   | double         | K&R C | 声明双精度浮点数                                             |
   | unsigned       | K&R C | 声明无符号类型变量                                           |
   | _Bool          | C11   | 声明布尔类型变量                                             |
   | _Complex       | C11   | 声明复数类型                                                 |
   | _Imaginary     | C11   | 声明虚数类型                                                 |
   | struct         | K&R C | 声明结构体变量                                               |
   | union          | K&R C | 声明联合体变量                                               |
   | enum           | C90   | 声明枚举类型                                                 |
   | sizeof         | K&R C | 返回指向的数据对象或类型所占空间的大小，以字节(byte)为单位   |
   | if             | K&R C | 选择语句，判断条件是否满足                                   |
   | switch         | K&R C | 选择语句，逐一判断条件是否满足                               |
   | else           | K&R C | 选择语句，条件不满足时                                       |
   | case           | K&R C | 标签语句，条件满足时                                         |
   | default        | K&R C | 标签语句，条件均不满足时或缺省时                             |
   | return         | K&R C | 跳转语句，函数返回                                           |
   | goto           | K&R C | 跳转语句，到指定的位置                                       |
   | typedef        | K&R C | 为对象创建别名                                               |
   | restrict       | K&R C | 用于编译器优化，只能用于指针，表明指针是访问数据对象唯一的方式 |
   | const          | C90   | 声明一个不能通过赋值，递增或递减来修改的对象                 |
   | volitile       | C90   | 用于编译器优化，告知计算机，代理(不是变量所在的程序)可以改变该变量的值 |
   | _Alignas       | C11   | 用于指明内存对齐相关                                         |
   | _Alignof       | C11   | 用于指明内存对齐相关                                         |
   | _Atomic        | C11   | 并发编程时声明一个原子类型的对象                             |
   | _Generic       | C11   | 实现泛型选择                                                 |
   | _Noreturn      | C11   | 设置调用函数后不返回                                         |
   | _Static_assert | C11   | 声明编译时检查的断言                                         |
   | _Thread_local  | C11   | 声明属于创建线程私有的线程局部数据变量                       |
   
   > 注1：关键字使用不当被视为语法错误；使用保留标识符虽然不会引起语法错误，但是可能导致其他的问题。例如**以下划线开头的标识符**（可能与编译器、操作系统、标准库冲突），或者**标准库函数名**，如`printf()`。
   >
   > 注2：可以引入stdbool.c，用C++的方法表示C语言中的布尔类型，让C代码与C++兼容。
   
   **标识符**：表示变量、函数或其他实体的名称，比如`num`即为标识符，代表一个变量。
   
   可以看出，一个声明包括两部分：关键字和标识符。
   
   > C语言中声明一个变量，不叫语句。
   >
   > 可以把需要建立存储空间的声明称为定义或定义性声明，把不需要建立存储空间的声明称为声明或引用性声明。
   >
   > 举例 前者：`int a`; 后者：`extern int a`;
   >
   
   **标识符的命名**：可以用小写字母、大写字母、数字和下划线来命名，名称的第1个字符必须是字符或下划线，而不能是数字。同时标识符**区分大小写**。
   
   **赋值**：`num=1;`将右边的值赋给左边的变量`num`。C语言没有赋值语句，所谓的赋值语句实际上是表达式语句的一种。
   
5. 数据类型

   数据类型方面分为四大数据类型、数据类型转换。

   **四大数据类型**：基本数据类型，构造数据类型，指针类型，空类型。

    <style> table th:first-of-type { width: 100px; } </style>

   | 数据类型     |                             说明                             |
   | ------------ | :----------------------------------------------------------: |
   | 基本数据类型 | 基本数据类型最主要的特点是，其值不可以再分解为其它类型。换言之，基本数据类型是自我说明的。 |
   | 构造数据类型 | 构造数据类型是根据已定义的一个或多个数据类型用构造的方法来定义的。也就是说，一个构造类型的值可以分解成若干个“成员”或“元素”。每个“成员”都是一个基本数据类型或又是一个构造类型。在C语言中，构造类型有以下几种：数组类型、结构体类型、共用体（联合）类型。 |
   | 指针类型     | 指针是一种特殊的，同时又是具有重要作用的数据类型。其值用来表示某个变量在内存储器中的地址。虽然指针变量的取值类似于整型量，但这是两个类型完全不同的量，因此不能混为一谈。 |
   | 空类型       | 在调用函数值时，通常应向调用者返回一个函数值。这个返回的函数值是具有一定的数据类型的，应在函数定义及函数说明中给以说明，但是，也有一类函数，调用后并不需要向调用者返回函数值，这种函数可以定义为“空类型”。其类型说明符为void。 |

   **数据类型转换**：分为自动转换和强制类型转换。
   
6. `printf()`函数

   该函数会查看传递给它的实参中的内容并打印在屏幕上。`printf`的`f`表示这是一种格式化打印函数。

   > 注意：
   >
   > 实际参数（实参）是传递给函数的特定值。
   >
   > 形式参数（形参）是函数中用于储存值的变量。
   >

   **函数调用**：输入函数名和所需的参数，程序运行到该行的时候控制权即转给该函数，函数执行结束后控制权再返回至调用函数位置所在的函数。函数调用语句属于表达式语句。

   **转义序列**：用于代表难以表示或无法输入的字符。见下表。

   | 转义序列 | 表示字符   | 含义                                |
   | -------- | ---------- | ----------------------------------- |
   | \t       | 水平制表符 | 移动到下一水平制表位，相当于Tab     |
   | \v       | 垂直制表符 | 移动到下一垂直制表位                |
   | \b       | Backspace  | 移回一个空格                        |
   | \n       | 换行符     | 移到下一行                          |
   | \r       | 回车符     | 光标返回至当前行行首，用于套印      |
   | \\\      | 反斜线     | 插入一个反斜线字符                  |
   | \0       | 空字符     | 插入一个空字符，它被定义为具有数值0 |
   
   **占位符**：指明输出变量值的位置，`%`表示要在该处打印一个变量，`d`表明把变量作为十进制整数打印，`f`表示输出为浮点数，保留6位小数。
   
7. 自定义函数

   函数原型：声明形式，又称为函数声明；

   函数调用：见上文；

   函数定义：函数本身的源代码；

7. `return`语句

   C函数结尾需要返回值，`main()`函数标明了`int`返回类型，因此`main()`函数末尾应当有`return`语句。

   如果遗漏该句，程序在执行到末尾花括号时也会自动返回0，因此本句可以省略，但是其他有返回值的函数中不能漏掉`return`语句。

   > `return`语句属于跳转语句。
   >
   > 主函数中的`return 0`可看作是统一代码风格，但对某些操作系统，如类Unix系统（Linux/MacOS/FreeBSD等) `return`语句有实际用途。
   >
   
9. 程序错误

   包括语法错误和语义错误。

   语法是规则，用于检查语言中各有效语句是否正确组合；语义是含义，由程序的执行行为表征。

   当代码存在**语法错误**时，编译器会报告语法错误消息；而代码存在的**语义错误**编译器则无法识别。
   
   即使输入正确无误，编译器也可能给出一些**警告**，错误消息表明程序中有错，源代码无法进行编译。而警告则表明，尽管编写的代码有效，但可能不是程序员想要的。警告并不终止编译。

